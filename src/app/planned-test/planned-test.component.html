<div class="main-content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <!-- Header -->
          <div class="header d-flex justify-content-between align-items-center">
            <div>
              <h4 class="title mb-0">Planned Tests</h4>
              <p class="category">List of scheduled QoS tests</p>
            </div>
            <button class="btn btn-primary" (click)="onNewPlannedTest()">New Planned Test</button>
          </div>

          <!-- Table -->
      <!-- Table -->
<div class="content table-responsive table-full-width">
  <table class="table table-hover table-striped">
    <thead>
      <tr>
        <th *ngFor="let cell of tableData.headerRow">{{ cell }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of tableData.dataRows">
        <!-- ✅ Colonne Control en premier -->
        <td>
          <span class="control-icon" (click)="toggleControl(row)">
            <i class="fa" [ngClass]="row.isPaused ? 'fa-pause' : 'fa-play'"></i>
          </span>
        </td>

        <!-- ✅ Colonne Test Name -->
        <td>{{ row.name }}</td>

        <!-- ✅ Colonne Test Duration -->
        <td>{{ row.duration }}</td>

        <!-- ✅ Colonne Number of Agents -->
        <td>{{ row.numberOfAgents }}</td>

        <!-- ✅ Colonne Creation Date -->
        <td>{{ row.createdAt | date: 'short' }}</td>

        <!-- ✅ Colonne Actions -->
        <td>
          <i class="fa fa-eye text-info me-2" (click)="onView(row)" style="cursor:pointer;" title="View"></i>
          <i class="fa fa-trash text-danger" (click)="onDelete(row)" style="cursor:pointer;" title="Delete"></i>
        </td>
      </tr>
    </tbody>
  </table>
</div>

        </div>
      </div>
    </div>
  </div>

  <!-- Details Popup -->
  <div class="popup-overlay" *ngIf="selectedTest">
    <div class="popup-box">
      <div class="popup-header">
        <h5 class="modal-title">Planned Test Details</h5>
        <button class="btn-close" (click)="closePopup()">×</button>
      </div>

      <div class="popup-body">
        <table class="table table-bordered">
          <tbody>
            <tr>
              <td><span class="control-icon" (click)="toggleControl(selectedTest)">
                <i [ngClass]="{'fa-pause': selectedTest.isPaused, 'fa-play': !selectedTest.isPaused}"></i></span>
              </td>
            </tr>
            <tr><th>Test Name</th><td>{{ selectedTest.name }}</td></tr>
            <tr><th>Duration</th><td>{{ selectedTest.duration }}</td></tr>
            <tr><th>Number of Agents</th><td>{{ selectedTest.numberOfAgents }}</td></tr>
            <tr><th>Created At</th><td>{{ selectedTest.createdAt | date: 'short' }}</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Wizard Popup -->
  <div class="wizard-overlay" *ngIf="showWizard">
    <div class="wizard-popup">
      <!-- Header -->
      <div class="wizard-header d-flex justify-content-between align-items-center">
        <h5>Create new test plan</h5>
        <button class="btn-close" (click)="cancelWizard()">×</button>
      </div>

      <!-- Stepper -->
      <div class="wizard-steps d-flex justify-content-between text-center my-3">
        <div [class.active]="wizardStep === 1">Initial Config<br><small>Name & Duration</small></div>
        <div [class.active]="wizardStep === 2">Groups<br><small>Groups & Tests</small></div>
        <div [class.active]="wizardStep === 3">Profiles<br><small>Targets & profiles</small></div>
      </div>

      <!-- Step 1 -->
      <div *ngIf="wizardStep === 1" class="wizard-step">
        <div class="mb-3">
          <label>Test Plan Name</label>
          <input type="text" class="form-control" [(ngModel)]="testPlan.name" />
        </div>
        <div class="mb-3">
          <label>Test Duration</label>
          <input type="text" class="form-control" [(ngModel)]="testPlan.duration" />
        </div>
      </div>

<!-- Step 2 -->
<div *ngIf="wizardStep === 2" class="wizard-step">

  <!-- Source Type Selection -->
  <div class="mb-3">
    <label class="form-label">Source is :</label>
    <div class="btn-group">
      <button class="btn"
        [ngClass]="{ 'btn-primary': sourceType === 'group', 'btn-outline-primary': sourceType !== 'group' }"
        (click)="sourceType = 'group'">
        Agent Group
      </button>
      <button class="btn"
        [ngClass]="{ 'btn-primary': sourceType === 'single', 'btn-outline-primary': sourceType !== 'single' }"
        (click)="sourceType = 'single'">
        Single Agent
      </button>
    </div>
  </div>

  <!-- Source and Target Selection -->
  <div class="mb-3">

    <!-- When Group selected -->
    <div *ngIf="sourceType === 'group'">
      <!-- Select Source Group -->
      <div class="form-group mb-2">
        <label for="agentGroupSelect" class="form-label">Select Agent Group</label>
        <select id="agentGroupSelect" [(ngModel)]="selectedAgentGroupId" name="agentGroupSelect" class="form-control">
          <option [value]="null" disabled>-- Select a group --</option>
          <option *ngFor="let group of agentGroups" [value]="group.id">{{ group.group_name }}</option>
        </select>
      </div>

      <!-- Select Target Group (same list) -->
      <div class="form-group">
        <label for="targetGroupSelect" class="form-label">Select Target Group</label>
        <select id="targetGroupSelect" [(ngModel)]="selectedTargetGroupId" name="targetGroupSelect" class="form-control">
          <option [value]="null" disabled>-- Select a target group --</option>
          <option *ngFor="let group of agentGroups" [value]="group.id">{{ group.group_name }}</option>
        </select>
      </div>
    </div>

    <!-- When Single Agent selected -->
    <div *ngIf="sourceType === 'single'">
      <!-- Select Source Agent -->
      <div class="form-group mb-2">
        <label for="agentSelect" class="form-label">Select Agent</label>
        <select id="agentSelect" [(ngModel)]="selectedAgentId" name="agentSelect" class="form-control">
          <option [value]="null" disabled>-- Select an agent --</option>
          <option *ngFor="let agent of agents" [value]="agent.id">{{ agent.name }}</option>
        </select>
      </div>

      <!-- Select Target Agent (same list) -->
      <div class="form-group">
        <label for="targetAgentSelect" class="form-label">Select Target Agent</label>
        <select id="targetAgentSelect" [(ngModel)]="selectedTargetAgentId" name="targetAgentSelect" class="form-control">
          <option [value]="null" disabled>-- Select a target agent --</option>
          <option *ngFor="let agent of agents" [value]="agent.id">{{ agent.name }}</option>
        </select>
      </div>
    </div>

  </div>

</div>


<!-- Step 3 -->
<div *ngIf="wizardStep === 3" class="wizard-step">
  
  <div class="mb-3">
    <label class="form-label">QoS Profile</label>
    <select class="form-control" [(ngModel)]="selectedTestProfileId">
      <option [value]="null" disabled>-- Select a QoS Profile --</option>
      <option *ngFor="let profile of qosProfiles" [value]="profile.id">{{ profile.profile_name }}</option>
    </select>
  </div>

  <!-- Selection of Threshold from the list of created thresholds -->
  <div class="mb-3">
    <label class="form-label">Threshold</label>
    <select class="form-control" [(ngModel)]="selectedThreshold" name="thresholdSelect" (change)="updateParameterBasedOnThreshold()">
      <option [value]="null" disabled>-- Select a threshold --</option>
      <option *ngFor="let threshold of thresholds" [value]="threshold.profileName">
        {{ threshold.profileName }} (Active: {{ threshold.activeThreshold }}, Disabled: {{ threshold.disabledThreshold }})
      </option>
      
    </select>
  </div>
  
  <!-- Display the updated parameter based on selected Threshold -->
  <div *ngIf="selectedParameter">
    <p>Updated Parameter: {{ selectedParameter }}</p>
  </div>
  
</div>

<!-- Wizard Footer -->
<div class="wizard-footer d-flex justify-content-between mt-4">
  <button class="btn btn-secondary" [disabled]="wizardStep === 1" (click)="prevStep()">Previous</button>
  <button class="btn btn-primary"
          *ngIf="wizardStep < 3"
          (click)="nextStep()">Next</button>
  <button class="btn btn-success"
          *ngIf="wizardStep === 3"
          (click)="finishWizard()">Finish</button>
</div>



