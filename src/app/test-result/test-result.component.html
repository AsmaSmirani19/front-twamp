<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="card">
        <div class="card-body table-responsive">
          <table class="table table-hover" *ngIf="testResults && testResults.length > 0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Status</th>
                <th>Agent</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let result of testResults; trackBy: trackByTestId">
                <td>{{ result.testName }}</td>
                <td>{{ result.testType }}</td>
                <td>
                  <span class="tag" [ngClass]="getStatusClass(result.status)">
                    {{ result.status }}
                  </span>
                </td>
                <td>{{ result.sourceAgent }}</td>
                <td>
                  <i class="fa fa-eye text-info me-2" (click)="onView(result)" style="cursor:pointer;"></i>
                  <i class="fa fa-trash text-danger" (click)="onDelete(result)" style="cursor:pointer;"></i>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="!testResults || testResults.length === 0" class="text-center text-muted">No results found.</div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Popup styled like Pinterest -->
<div class="pinterest-popup-overlay" *ngIf="selectedResult">
  <div class="pinterest-popup-card">
    
    <!-- Header -->
    <div class="popup-header">
      <h4>{{ selectedResult.testName }}</h4>
      <button class="close-btn" aria-label="Close" (click)="closePopup()">&times;</button>
    </div>

    <!-- Body -->
    <div class="popup-body">
      
      <!-- Test Info -->
      <div class="test-info">
        <p><strong>Status:</strong>
          <span [ngClass]="getStatusClass(selectedResult.status)">
            {{ selectedResult.status }}
          </span>
        </p>
        <p><strong>Creation Date:</strong> {{ selectedResult.creationDate | date: 'medium' }}</p>
        <p><strong>Duration:</strong> {{ selectedResult.testDuration }}</p>
        <p><strong>Source Agent:</strong> {{ selectedResult.sourceAgent }}</p>
        <p><strong>Target Agent:</strong> {{ selectedResult.targetAgent }}</p>
      </div>

      <!-- Metric Tabs -->
      <div class="metric-tabs">
        <button 
          *ngFor="let metric of ['latency', 'jitter', 'throughput']"
          [ngClass]="{ 'active': selectedMetric === metric }"
          (click)="switchMetric(metric)">
          {{ metric | titlecase }}
        </button>
      </div>

      <!-- Stats -->
      <div class="stats-grid" *ngIf="selectedResult.minValue !== undefined">
        <div class="stat-item">
          <span class="stat-label">Min Value:</span>
          <span class="stat-value">{{ selectedResult.minValue }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Max Value:</span>
          <span class="stat-value">{{ selectedResult.maxValue }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Avg Value:</span>
          <span class="stat-value">{{ selectedResult.avgValue }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Success Rate:</span>
          <span class="stat-value">{{ selectedResult.successRate }}%</span>
        </div>
      </div>

    <!-- Charts -->
  <div class="chart-wrapper">

    <!-- Latency Chart -->
    <ng-container *ngIf="selectedMetric === 'latency'">
      <div class="chart-container" style="min-height:300px;">
        <canvas *ngIf="hasValidChartData(latencyChart); else noLatency"
                baseChart
                latencyChartRef="baseChart"
                [data]="latencyChart"
                [options]="chartOptions"
                [type]="'line'">
        </canvas>
        <ng-template #noLatency>
          <div class="no-data-message">No latency data available</div>
        </ng-template>
      </div>
    </ng-container>

    <!-- Jitter Chart -->
    <ng-container *ngIf="selectedMetric === 'jitter'">
      <div class="chart-container" style="min-height:300px;">
        <canvas *ngIf="hasValidChartData(jitterChart); else noJitter"
                baseChart
                jitterChartRef="baseChart"
                [data]="jitterChart"
                [options]="chartOptions"
                [type]="'line'">
        </canvas>
        <ng-template #noJitter>
          <div class="no-data-message">No jitter data available</div>
        </ng-template>
      </div>
    </ng-container>

    <!-- Throughput Chart -->
    <ng-container *ngIf="selectedMetric === 'throughput'">
      <div class="chart-container" style="min-height:300px;">
        <canvas *ngIf="hasValidChartData(throughputChart); else noThroughput"
                baseChart
                throughputChartRef="baseChart"
                [data]="throughputChart"
                [options]="chartOptions"
                [type]="'line'">
        </canvas>
        <ng-template #noThroughput>
          <div class="no-data-message">No throughput data available</div>
        </ng-template>
      </div>
    </ng-container>

  </div>

    </div>
  </div>
</div>
